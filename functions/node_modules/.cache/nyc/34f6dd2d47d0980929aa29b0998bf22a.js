var cov_2jio17ujlz=function(){var path="/home/clement/Projects/movieInfoBot/functions/index.js",hash="e810cecea63a8e3fbea19534d551e7e1f7f6a201",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/home/clement/Projects/movieInfoBot/functions/index.js",statementMap:{"0":{start:{line:3,column:16},end:{line:3,column:34}},"1":{start:{line:4,column:18},end:{line:4,column:47}},"2":{start:{line:6,column:13},end:{line:6,column:37}},"3":{start:{line:7,column:19},end:{line:7,column:29}},"4":{start:{line:16,column:2},end:{line:29,column:5}},"5":{start:{line:18,column:17},end:{line:18,column:72}},"6":{start:{line:21,column:4},end:{line:28,column:7}},"7":{start:{line:22,column:6},end:{line:24,column:7}},"8":{start:{line:23,column:8},end:{line:23,column:17}},"9":{start:{line:26,column:21},end:{line:26,column:64}},"10":{start:{line:27,column:6},end:{line:27,column:22}},"11":{start:{line:32,column:0},end:{line:41,column:3}},"12":{start:{line:34,column:16},end:{line:34,column:62}},"13":{start:{line:36,column:2},end:{line:40,column:5}},"14":{start:{line:37,column:4},end:{line:37,column:42}},"15":{start:{line:39,column:4},end:{line:39,column:118}},"16":{start:{line:44,column:0},end:{line:44,column:22}}},fnMap:{"0":{name:"callOMDbApi",decl:{start:{line:15,column:9},end:{line:15,column:20}},loc:{start:{line:15,column:28},end:{line:30,column:1}},line:15},"1":{name:"(anonymous_1)",decl:{start:{line:16,column:21},end:{line:16,column:22}},loc:{start:{line:16,column:42},end:{line:29,column:3}},line:16},"2":{name:"(anonymous_2)",decl:{start:{line:21,column:41},end:{line:21,column:42}},loc:{start:{line:21,column:61},end:{line:28,column:5}},line:21},"3":{name:"(anonymous_3)",decl:{start:{line:32,column:66},end:{line:32,column:67}},loc:{start:{line:32,column:80},end:{line:41,column:1}},line:32},"4":{name:"(anonymous_4)",decl:{start:{line:36,column:26},end:{line:36,column:27}},loc:{start:{line:36,column:38},end:{line:38,column:3}},line:36},"5":{name:"(anonymous_5)",decl:{start:{line:38,column:11},end:{line:38,column:12}},loc:{start:{line:38,column:17},end:{line:40,column:3}},line:38}},branchMap:{"0":{loc:{start:{line:22,column:6},end:{line:24,column:7}},type:"if",locations:[{start:{line:22,column:6},end:{line:24,column:7}},{start:{line:22,column:6},end:{line:24,column:7}}],line:22}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();/* @flow */const request=(cov_2jio17ujlz.s[0]++,require('request'));const functions=(cov_2jio17ujlz.s[1]++,require('firebase-functions'));const host=(cov_2jio17ujlz.s[2]++,'http://www.omdbapi.com');const OMDbApiKey=(cov_2jio17ujlz.s[3]++,'4e6c7490');/**
 * a call to the external API OMDb to get the movie infos
 * @param {string} title - the title of the movie
 * @return {Promise} the output text
 */function callOMDbApi(title){cov_2jio17ujlz.f[0]++;cov_2jio17ujlz.s[4]++;return new Promise((resolve,reject)=>{cov_2jio17ujlz.f[1]++;// Create the path for the HTTP request to get the movie infos
const path=(cov_2jio17ujlz.s[5]++,`/?apikey=${OMDbApiKey}&t=${encodeURIComponent(title)}`);// Make the HTTP request
cov_2jio17ujlz.s[6]++;request(host+path,{json:true},(err,res,body)=>{cov_2jio17ujlz.f[2]++;cov_2jio17ujlz.s[7]++;if(err){cov_2jio17ujlz.b[0][0]++;cov_2jio17ujlz.s[8]++;reject();}else{cov_2jio17ujlz.b[0][1]++;}// Resolve the promise with the output text
const output=(cov_2jio17ujlz.s[9]++,`${body.Title}(${body.Year}): ${body.Plot}`);cov_2jio17ujlz.s[10]++;resolve(output);});});}cov_2jio17ujlz.s[11]++;exports.dialogflowFirebaseFulfillment=functions.https.onRequest((req,res)=>{cov_2jio17ujlz.f[3]++;// Get the title and date from the request
const title=(cov_2jio17ujlz.s[12]++,req.body.queryResult.parameters['movie-title']);// Call the OMDb API
cov_2jio17ujlz.s[13]++;callOMDbApi(title).then(output=>{cov_2jio17ujlz.f[4]++;cov_2jio17ujlz.s[14]++;res.json({fulfillmentText:output});}).catch(()=>{cov_2jio17ujlz.f[5]++;cov_2jio17ujlz.s[15]++;res.json({fulfillmentText:"Sorry, I don't know this movie (misspelled?). Be sure to give the english title."});});});cov_2jio17ujlz.s[16]++;callOMDbApi('batman');